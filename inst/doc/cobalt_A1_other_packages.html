<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Noah Greifer" />

<meta name="date" content="2020-08-31" />

<title>Appendix 1: Using cobalt with Other Preprocessing Packages</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Appendix 1: Using cobalt with Other Preprocessing Packages</h1>
<h4 class="author">Noah Greifer</h4>
<h4 class="date">2020-08-31</h4>


<div id="TOC">
<ul>
<li><a href="#utilities">Utilities</a><ul>
<li><a href="#f.build"><code>f.build()</code></a></li>
<li><a href="#splitfactor-and-unsplitfactor"><code>splitfactor()</code> and <code>unsplitfactor()</code></a></li>
<li><a href="#get.w"><code>get.w()</code></a></li>
</ul></li>
<li><a href="#bal.tab"><code>bal.tab()</code></a><ul>
<li><a href="#using-bal.tab-with-twang">Using <code>bal.tab()</code> with <code>twang</code></a></li>
<li><a href="#using-bal.tab-with-matching">Using <code>bal.tab()</code> with <code>Matching</code></a></li>
<li><a href="#using-bal.tab-with-optmatch">Using <code>bal.tab()</code> with <code>optmatch</code></a></li>
<li><a href="#using-bal.tab-with-cbps">Using <code>bal.tab()</code> with <code>CBPS</code></a></li>
<li><a href="#using-bal.tab-with-ebal">Using <code>bal.tab()</code> with <code>ebal</code></a></li>
<li><a href="#using-bal.tab-with-designmatch">Using <code>bal.tab()</code> with <code>designmatch</code></a></li>
<li><a href="#using-bal.tab-with-sbw">Using <code>bal.tab()</code> with <code>sbw</code></a></li>
<li><a href="#using-bal.tab-with-matchthem">Using <code>bal.tab()</code> with <code>MatchThem</code></a></li>
<li><a href="#using-bal.tab-with-cem">Using <code>bal.tab()</code> with <code>cem</code></a></li>
<li><a href="#using-bal.tab-with-other-packages">Using <code>bal.tab()</code> with other packages</a></li>
</ul></li>
</ul>
</div>

<p>This is an appendix to the main vignette, “Covariate Balance Tables and Plots: A Guide to the cobalt Package”. It contains descriptions and demonstrations of several utility functions in <code>cobalt</code> and the use of <code>bal.tab()</code> with <code>twang</code>, <code>Matching</code>, <code>optmatch</code>, <code>CBPS</code>, <code>ebal</code>, <code>designmatch</code>, <code>sbw</code>, <code>MatchThem</code>, and <code>cem</code>. Note that <code>MatchIt</code> can perform most of the functions that <code>Matching</code>, <code>optmatch</code>, and <code>cem</code> can, and <code>WeightIt</code> can perform most of the functions that <code>twang</code>, <code>CBPS</code>, <code>ebal</code>, and <code>sbw</code> can. Because <code>cobalt</code> has been optimized to work with <code>MatchIt</code> and <code>WeightIt</code>, it is recommended to use those packages to simplify preprocessing and balance assessment, but we recognize users may prefer to use the packages described in this vignette.</p>
<div id="utilities" class="section level2">
<h2>Utilities</h2>
<p>In addition to its main balance assessment functions, <code>cobalt</code> contains several utility functions. These are meant to reduce the typing and programming burden that often accompany the use of R with a diverse set of packages.</p>
<div id="f.build" class="section level3">
<h3><code>f.build()</code></h3>
<p><code>f.build()</code> is a small tool that can be helpful in quickly specifying formula inputs to functions. An example is provided below:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">data</span>(<span class="st">&quot;lalonde&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;cobalt&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a>covs &lt;-<span class="st"> </span><span class="kw">subset</span>(lalonde, <span class="dt">select =</span> <span class="op">-</span><span class="kw">c</span>(treat, re78))</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">f.build</span>(<span class="st">&quot;treat&quot;</span>, covs)</span></code></pre></div>
<pre><code>## treat ~ age + educ + race + married + nodegree + re74 + re75
## &lt;environment: 0x7fe8e8fa5a38&gt;</code></pre>
<p>The function creates a <code>formula</code> object from two inputs: the first argument is the quoted name of the variable to be the left hand side (response) variable in the formula; the second argument is a vector of right hand side (predictor) variable names or a data frame, the variable names of which are to be the predictor variables. The utility of <code>f.build()</code> is that the user does not have to manually type out the name of every covariate when entering a formula into a function. It can be used simply in place of a formula, as in the following examples, which make use of the objects defined above:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Generating propensity scores using logistic regression</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>p.score &lt;-<span class="st"> </span><span class="kw">glm</span>(<span class="kw">f.build</span>(<span class="st">&quot;treat&quot;</span>, covs), <span class="dt">data =</span> lalonde, <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>)<span class="op">$</span>fitted.values</span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co"># Using matchit() from the MatchIt package</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="kw">library</span>(<span class="st">&quot;MatchIt&quot;</span>)</span>
<span id="cb3-6"><a href="#cb3-6"></a>m.out &lt;-<span class="st"> </span><span class="kw">matchit</span>(<span class="kw">f.build</span>(<span class="st">&quot;treat&quot;</span>, covs), <span class="dt">data =</span> lalonde, <span class="dt">method =</span> <span class="st">&quot;nearest&quot;</span>)</span></code></pre></div>
</div>
<div id="splitfactor-and-unsplitfactor" class="section level3">
<h3><code>splitfactor()</code> and <code>unsplitfactor()</code></h3>
<p>Some functions (outside of <code>cobalt</code>) are not friendly to factor or character variables, and require numeric variables to operate correctly. For example, some regression-style functions, such as <code>ebalance()</code> in <code>ebal</code>, can only take in non-singular numeric matrices. Other functions will process factor variables, but will return output in terms of dummy coded version of the factors. For example, <code>lm()</code> will create dummy variables out of a factor and drop the reference category to create regression coefficients.</p>
<p>To prepare data sets for use in functions that do not allow factors or to mimic the output of functions that split factor variables, users can use <code>splitfactor()</code>, which takes in a data set and the names of variables to split, and outputs a new data set with newly created dummy variables. Below is an example splitting the <code>race</code> variable in the Lalonde data set into dummies, eliminating the reference category (<code>&quot;black&quot;</code>):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">head</span>(lalonde)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">treat</th>
<th align="right">age</th>
<th align="right">educ</th>
<th align="left">race</th>
<th align="right">married</th>
<th align="right">nodegree</th>
<th align="right">re74</th>
<th align="right">re75</th>
<th align="right">re78</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">37</td>
<td align="right">11</td>
<td align="left">black</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">9930.0460</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">22</td>
<td align="right">9</td>
<td align="left">hispan</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3595.8940</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">30</td>
<td align="right">12</td>
<td align="left">black</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">24909.4500</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">27</td>
<td align="right">11</td>
<td align="left">black</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">7506.1460</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">33</td>
<td align="right">8</td>
<td align="left">black</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">289.7899</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">22</td>
<td align="right">9</td>
<td align="left">black</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">4056.4940</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>lalonde.split &lt;-<span class="st"> </span><span class="kw">splitfactor</span>(lalonde, <span class="st">&quot;race&quot;</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="kw">head</span>(lalonde.split)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">treat</th>
<th align="right">age</th>
<th align="right">educ</th>
<th align="right">race_hispan</th>
<th align="right">race_white</th>
<th align="right">married</th>
<th align="right">nodegree</th>
<th align="right">re74</th>
<th align="right">re75</th>
<th align="right">re78</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">37</td>
<td align="right">11</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">9930.0460</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">22</td>
<td align="right">9</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3595.8940</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">30</td>
<td align="right">12</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">24909.4500</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">27</td>
<td align="right">11</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">7506.1460</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">33</td>
<td align="right">8</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">289.7899</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">22</td>
<td align="right">9</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">4056.4940</td>
</tr>
</tbody>
</table>
</div>
<p>It is possible to undo the action of <code>splitfactor()</code> with <code>unsplitfactor()</code>, which takes in a data set with dummy variables formed from <code>splitfactor()</code> or otherwise and recreates the original factor variable. If the reference category was dropped, its value needs to be supplied.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>lalonde.unsplit &lt;-<span class="st"> </span><span class="kw">unsplitfactor</span>(lalonde.split, <span class="st">&quot;race&quot;</span>, </span>
<span id="cb6-2"><a href="#cb6-2"></a>                                 <span class="dt">dropped.level =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="kw">head</span>(lalonde.unsplit)</span></code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">treat</th>
<th align="right">age</th>
<th align="right">educ</th>
<th align="left">race</th>
<th align="right">married</th>
<th align="right">nodegree</th>
<th align="right">re74</th>
<th align="right">re75</th>
<th align="right">re78</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">37</td>
<td align="right">11</td>
<td align="left">black</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">9930.0460</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">22</td>
<td align="right">9</td>
<td align="left">hispan</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3595.8940</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">30</td>
<td align="right">12</td>
<td align="left">black</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">24909.4500</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">27</td>
<td align="right">11</td>
<td align="left">black</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">7506.1460</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">33</td>
<td align="right">8</td>
<td align="left">black</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">289.7899</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">22</td>
<td align="right">9</td>
<td align="left">black</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">4056.4940</td>
</tr>
</tbody>
</table>
</div>
<p>Notice the original data set and the unsplit data set look identical. If the input to <code>unsplitfactor()</code> is the output of a call to <code>splitfactor()</code> (as it was here), you don’t need to tell <code>unsplitfactor()</code> the name of the split variable or the value of the dropped level. It was done here for illustration purposes.</p>
</div>
<div id="get.w" class="section level3">
<h3><code>get.w()</code></h3>
<p><code>get.w()</code> allows users to extract weights from the output of a call to a preprocessing function in one of the supported packages. Because each package stores weights in different ways, it can be helpful to have a single function that applies equally to all outputs. <code>twang</code> has a function called <code>get.weights()</code> that performs the same functions with slightly finer control for the output of a call to <code>ps()</code>.</p>
</div>
</div>
<div id="bal.tab" class="section level2">
<h2><code>bal.tab()</code></h2>
<p>The next sections describe the use of <code>bal.tab()</code> with packages other than those described in the main vignette. Even if you are using <code>bal.tab()</code> with one of these packages, it may be useful to read the main vignette to understand <code>bal.tab()</code>’s main options, which are not detailed here.</p>
<div id="using-bal.tab-with-twang" class="section level3">
<h3>Using <code>bal.tab()</code> with <code>twang</code></h3>
<p>Generalized boosted modeling (GBM), as implemented in <code>twang</code>, can be an effective way to generate propensity scores and weights for use in propensity score weighting. <code>bal.tab()</code> functions similarly to the functions <code>bal.table()</code> and <code>summary()</code> when used with GBM in <code>twang</code>. Below is a simple example of its use:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">library</span>(<span class="st">&quot;twang&quot;</span>)</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw">data</span>(<span class="st">&quot;lalonde&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;cobalt&quot;</span>) <span class="co">##If not yet loaded</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>covs0 &lt;-<span class="st"> </span><span class="kw">subset</span>(lalonde, <span class="dt">select =</span> <span class="op">-</span><span class="kw">c</span>(treat, re78))</span>
<span id="cb7-4"><a href="#cb7-4"></a></span>
<span id="cb7-5"><a href="#cb7-5"></a>ps.out &lt;-<span class="st"> </span><span class="kw">ps</span>(<span class="kw">f.build</span>(<span class="st">&quot;treat&quot;</span>, covs0), <span class="dt">data =</span> lalonde, </span>
<span id="cb7-6"><a href="#cb7-6"></a>             <span class="dt">stop.method =</span> <span class="kw">c</span>(<span class="st">&quot;es.mean&quot;</span>, <span class="st">&quot;es.max&quot;</span>), </span>
<span id="cb7-7"><a href="#cb7-7"></a>             <span class="dt">estimand =</span> <span class="st">&quot;ATT&quot;</span>, <span class="dt">n.trees =</span> <span class="dv">1000</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="kw">bal.tab</span>(ps.out, <span class="dt">stop.method =</span> <span class="st">&quot;es.mean&quot;</span>)</span></code></pre></div>
<pre><code>## Call
##  ps(formula = f.build(&quot;treat&quot;, covs0), data = lalonde, n.trees = 1000, 
##     verbose = FALSE, estimand = &quot;ATT&quot;, stop.method = c(&quot;es.mean&quot;, 
##         &quot;es.max&quot;))
## 
## Balance Measures
##                 Type Diff.Adj
## prop.score  Distance   0.5188
## age          Contin.   0.0411
## educ         Contin.  -0.0834
## race_black    Binary   0.0256
## race_hispan   Binary  -0.0010
## race_white    Binary  -0.0246
## married       Binary  -0.0121
## nodegree      Binary   0.0880
## re74         Contin.   0.0671
## re75         Contin.   0.0934
## 
## Effective sample sizes
##            Control Treated
## Unadjusted  429.       185
## Adjusted     33.38     185</code></pre>
<p>The output looks a bit different from <code>twang</code>’s <code>bal.table()</code> output. First is the original call to <code>ps()</code>. Next is the balance table containing mean differences for the covariates included in the input to <code>ps()</code>. Last is a table displaying sample size information, similar to what would be generated using <code>twang</code>’s <code>summary()</code> function. The “effective” sample size is displayed when weighting is used; it is calculated as is done in <code>twang</code>. See the <code>twang</code> documentation, <code>?bal.tab</code>, or “Details on Calculations” in the main vignette for details on this calculation.</p>
<p>When using <code>bal.tab()</code> with <code>twang</code>, the user must specify the <code>ps</code> object, the output of a call to <code>ps()</code>, as the first argument. The second argument, <code>stop.method</code>, is the name of the stop method(s) for which balance is to be assessed, since a <code>ps</code> object may contain more than one if so specified. <code>bal.tab()</code> can display the balance for more than one stop method at a time by specifying a vector of stop method names. If this argument is left empty or if the argument to <code>stop.method</code> does not correspond to any of the stop methods in the <code>ps</code> object, <code>bal.tab()</code> will default to displaying balance for all stop methods available. Abbreviations are allowed for the stop method, which is not case sensitive.</p>
<p>The other arguments to <code>bal.tab()</code> when using it with <code>twang</code> have the same form and function as those given when using it without a conditioning package, except for <code>s.d.denom</code>. If the estimand of the stop method used is the ATT, <code>s.d.denom</code> will default to <code>&quot;treated&quot;</code> if not specified, and if the estimand is the ATE, <code>s.d.denom</code> will default to <code>&quot;pooled&quot;</code>, mimicking the behavior of <code>twang</code>. The user can specify their own argument to <code>s.d.denom</code>, but using the defaults is advised.</p>
<p>If sampling weights are used in the call to <code>ps()</code>, they will be automatically incorporated into the <code>bal.tab()</code> calculations for both the adjusted and unadjusted samples, just as <code>twang</code> does.</p>
<p><code>mnps</code> objects resulting from fitting models in <code>twang</code> with multi-category treatments are also compatible with <code>cobalt</code>. See the section “Using <code>cobalt</code> with multi-category treatments” in the main vignette. <code>iptw</code> objects resulting from fitting models in <code>twang</code> with longitudinal treatments are also compatible with <code>cobalt</code>. See the Appendix 3 vignette. <code>ps.cont</code> objects resulting from using <code>ps.cont()</code> in <code>WeightIt</code>, which implements GBM for continuous treatments, are also compatible. See the section “Using <code>cobalt</code> with continuous treatments” in the main vignette.</p>
</div>
<div id="using-bal.tab-with-matching" class="section level3">
<h3>Using <code>bal.tab()</code> with <code>Matching</code></h3>
<p>The <code>Matching</code> package is used for propensity score matching, and was also the first package to implement genetic matching. <code>MatchIt</code> calls <code>Matching</code> to use genetic matching and can accomplish many of the matching methods <code>Matching</code> can, but <code>Matching</code> is still a widely used package with its own strengths. <code>bal.tab()</code> functions similarly to <code>Matching</code>’s <code>MatchBalance()</code> command, which yields a thorough presentation of balance, and makes <code>Matching</code> the only package of those integrated with <code>cobalt</code> to display variance ratios by default. Below is a simple example of the use of <code>bal.tab()</code> with <code>Matching</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">library</span>(<span class="st">&quot;Matching&quot;</span>)</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="kw">data</span>(<span class="st">&quot;lalonde&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;cobalt&quot;</span>) <span class="co">#If not yet loaded</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>covs0 &lt;-<span class="st"> </span><span class="kw">subset</span>(lalonde, <span class="dt">select =</span> <span class="op">-</span><span class="kw">c</span>(treat, re78))</span>
<span id="cb9-4"><a href="#cb9-4"></a></span>
<span id="cb9-5"><a href="#cb9-5"></a>fit &lt;-<span class="st"> </span><span class="kw">glm</span>(<span class="kw">f.build</span>(<span class="st">&quot;treat&quot;</span>, covs0), <span class="dt">data =</span> lalonde, <span class="dt">family =</span> binomial)</span>
<span id="cb9-6"><a href="#cb9-6"></a>p.score &lt;-<span class="st"> </span>fit<span class="op">$</span>fitted.values</span>
<span id="cb9-7"><a href="#cb9-7"></a>match.out &lt;-<span class="st"> </span><span class="kw">Match</span>(<span class="dt">Tr =</span> lalonde<span class="op">$</span>treat, <span class="dt">X =</span> p.score, <span class="dt">estimand =</span> <span class="st">&quot;ATT&quot;</span>)</span>
<span id="cb9-8"><a href="#cb9-8"></a></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="kw">bal.tab</span>(match.out, <span class="dt">formula =</span> <span class="kw">f.build</span>(<span class="st">&quot;treat&quot;</span>, covs0), <span class="dt">data =</span> lalonde,</span>
<span id="cb9-10"><a href="#cb9-10"></a>        <span class="dt">distance =</span> <span class="op">~</span><span class="st"> </span>p.score)</span></code></pre></div>
<pre><code>## Balance Measures
##                 Type Diff.Adj
## p.score     Distance   0.0043
## age          Contin.   0.2106
## educ         Contin.   0.0201
## race_black    Binary   0.0054
## race_hispan   Binary  -0.0051
## race_white    Binary  -0.0003
## married       Binary   0.0661
## nodegree      Binary  -0.0079
## re74         Contin.  -0.0772
## re75         Contin.  -0.0127
## 
## Sample sizes
##                      Control Treated
## All                   429.       185
## Matched (ESS)          49.17     185
## Matched (Unweighted)  136.       185
## Unmatched             293.         0</code></pre>
<p>The output looks quite different from <code>Matching</code>’s <code>MatchBalance()</code> output. Rather than being stacked vertically, balance statistics are arranged horizontally in a table format, allowing for quick balance checking. Below the balance table is a summary of the sample size before and after matching, similar to what <code>Matching</code>’s <code>summary()</code> command would display. The sample size can include a “weighted” and “unweighted” count; the “weighted” count is the sum of the matching weights, while the “unweighted” is the count of units with nonzero matching weights.</p>
<p>The input to <code>bal.tab()</code> is similar to that given to <code>MatchBalance()</code>: the <code>Match</code> object resulting from the call to <code>Match()</code>, a formula relating treatment to the covariates for which balance is to be assessed, and the original data set. This is not the only way to call <code>bal.tab()</code>: instead of a formula and a data set, one can also input a data frame of covariates and a vector of treatment status indicators, just as when using <code>bal.tab()</code> without a conditioning package. For example, the code below will yield the same results as the call to <code>bal.tab()</code> above:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">bal.tab</span>(match.out, <span class="dt">treat =</span> lalonde<span class="op">$</span>treat, <span class="dt">covs =</span> covs0,</span>
<span id="cb11-2"><a href="#cb11-2"></a>        <span class="dt">distance =</span> <span class="op">~</span><span class="st"> </span>p.score)</span></code></pre></div>
<p>The other arguments to <code>bal.tab()</code> when using it with <code>Matching</code> have the same form and function as those given when using it without a conditioning package, except for <code>s.d.denom</code>. If the estimand of the original call to <code>Match()</code> is the ATT, <code>s.d.denom</code> will default to <code>&quot;treated&quot;</code> if not specified; if the estimand is the ATE, <code>s.d.denom</code> will default to <code>&quot;pooled&quot;</code>; if the estimand is the ATC, <code>s.d.denom</code> will default to <code>&quot;control&quot;</code>. The user can specify their own argument to <code>s.d.denom</code>, but using the defaults is advisable. In addition, the use of the <code>addl</code> argument is unnecessary because the covariates are entered manually as arguments, so all covariates for which balance is to be assessed can be entered through the <code>formula</code> or <code>covs</code> argument. If the covariates are stored in two separate data frames, it may be useful to include one in <code>formula</code> or <code>covs</code> and the other in <code>addl</code>.</p>
</div>
<div id="using-bal.tab-with-optmatch" class="section level3">
<h3>Using <code>bal.tab()</code> with <code>optmatch</code></h3>
<p>The <code>optmatch</code> package is useful for performing optimal pairwise or full matching. Most functions in <code>optmatch</code> are subsumed in <code>MatchIt</code>, but <code>optmatch</code> sees use from those who want finer control of the matching process than <code>MatchIt</code> allows. The output of calls to functions in <code>optmatch</code> is an <code>optmatch</code> object, which contains matching stratum membership for each unit in the given data set. Units that are matched with each other are assigned the same matching stratum. The user guide for <code>optmatch</code> recommends using the <code>RItools</code> package for balance assessment, but below is an example of how to use <code>bal.tab()</code> for the same purpose. Note that some results will differ between <code>cobalt</code> and <code>RItools</code> because of differences in how balance is calculated in each.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co">#Optimal full matching on the propensity score</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="kw">library</span>(<span class="st">&quot;optmatch&quot;</span>)</span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="kw">data</span>(<span class="st">&quot;lalonde&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;cobalt&quot;</span>) <span class="co">#If not yet loaded</span></span>
<span id="cb12-4"><a href="#cb12-4"></a>covs0 &lt;-<span class="st"> </span><span class="kw">subset</span>(lalonde, <span class="dt">select =</span> <span class="op">-</span><span class="kw">c</span>(treat, re78))</span>
<span id="cb12-5"><a href="#cb12-5"></a></span>
<span id="cb12-6"><a href="#cb12-6"></a>fit &lt;-<span class="st"> </span><span class="kw">glm</span>(<span class="kw">f.build</span>(<span class="st">&quot;treat&quot;</span>, covs0), <span class="dt">data =</span> lalonde, <span class="dt">family =</span> binomial)</span>
<span id="cb12-7"><a href="#cb12-7"></a>p.score &lt;-<span class="st"> </span>fit<span class="op">$</span>fitted.values <span class="co">#get the propensity score</span></span>
<span id="cb12-8"><a href="#cb12-8"></a>fm &lt;-<span class="st"> </span><span class="kw">fullmatch</span>(treat <span class="op">~</span><span class="st"> </span>p.score, <span class="dt">data =</span> lalonde)</span>
<span id="cb12-9"><a href="#cb12-9"></a></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="kw">bal.tab</span>(fm, <span class="dt">covs =</span> covs0, <span class="dt">distance =</span> <span class="op">~</span><span class="st"> </span>p.score)</span></code></pre></div>
<pre><code>## Call
##  fullmatch(x = treat ~ p.score, data = lalonde)
## 
## Balance Measures
##                 Type Diff.Adj
## p.score     Distance   0.0052
## age          Contin.   0.1623
## educ         Contin.  -0.0185
## race_black    Binary   0.0086
## race_hispan   Binary  -0.0064
## race_white    Binary  -0.0022
## married       Binary   0.0573
## nodegree      Binary   0.0026
## re74         Contin.  -0.0643
## re75         Contin.  -0.0084
## 
## Sample sizes
##                      Control Treated
## All                   429.       185
## Matched (ESS)          52.52     185
## Matched (Unweighted)  429.       185</code></pre>
<p>Most details for the use of <code>bal.tab()</code> with <code>optmatch</code> are similar to those when using <code>bal.tab()</code> with <code>Matching</code>. Users can enter either a formula and a data set or a vector of treatment status and a set of covariates. Unlike with <code>Matching</code>, entering the treatment variable is optional as it is already stored in the <code>optmatch</code> object. <code>bal.tab()</code> is compatible with both <code>pairmatch()</code> and <code>fullmatch()</code> output.</p>
</div>
<div id="using-bal.tab-with-cbps" class="section level3">
<h3>Using <code>bal.tab()</code> with <code>CBPS</code></h3>
<p>The <code>CBPS</code> (Covariate Balancing Propensity Score) package is a great tool for generating covariate balancing propensity scores, a class of propensity scores that are quite effective at balancing covariates among groups. <code>CBPS</code> includes functions for estimating propensity scores for binary, multi-category, and continuous treatments. <code>bal.tab()</code> functions similarly to <code>CBPS</code>’s <code>balance()</code> command. Below is a simple example of its use with a binary treatment:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw">library</span>(<span class="st">&quot;CBPS&quot;</span>)</span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="kw">data</span>(<span class="st">&quot;lalonde&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;cobalt&quot;</span>) <span class="co">#If not yet loaded</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>covs0 &lt;-<span class="st"> </span><span class="kw">subset</span>(lalonde, <span class="dt">select =</span> <span class="op">-</span><span class="kw">c</span>(treat, re78))</span>
<span id="cb14-4"><a href="#cb14-4"></a></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="co">#Generating covariate balancing propensity score weights for ATT</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>cbps.out &lt;-<span class="st"> </span><span class="kw">CBPS</span>(<span class="kw">f.build</span>(<span class="st">&quot;treat&quot;</span>, covs0), <span class="dt">data =</span> lalonde)</span></code></pre></div>
<pre><code>## [1] &quot;Finding ATT with T=1 as the treatment.  Set ATT=2 to find ATT with T=0 as the treatment&quot;</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw">bal.tab</span>(cbps.out)</span></code></pre></div>
<pre><code>## Call
##  CBPS(formula = f.build(&quot;treat&quot;, covs0), data = lalonde)
## 
## Balance Measures
##                 Type Diff.Adj
## prop.score  Distance  -0.0057
## age          Contin.  -0.0052
## educ         Contin.  -0.0017
## race_black    Binary   0.0019
## race_hispan   Binary  -0.0002
## race_white    Binary  -0.0017
## married       Binary  -0.0029
## nodegree      Binary   0.0042
## re74         Contin.  -0.0078
## re75         Contin.   0.0061
## 
## Effective sample sizes
##            Control Treated
## Unadjusted  429.       185
## Adjusted     99.97     185</code></pre>
<p>First is the original call to <code>CBPS()</code>. Next is the balance table containing mean differences for the covariates included in the input to <code>CBPS()</code>. Last is a table displaying sample size information. The “effective” sample size is displayed when weighting (rather than matching or subclassification) is used; it is calculated as is done in <code>twang</code>. See the <code>twang</code> documentation, <code>?bal.tab</code>, or “Details on Calculations” in the main vignette for details on this calculation.</p>
<p>The other arguments to <code>bal.tab()</code> when using it with <code>CBPS</code> have the same form and function as those given when using it without a conditioning package, except for <code>s.d.denom</code>. If the estimand of the original call to <code>CBPS()</code> is the ATT, <code>s.d.denom</code> will default to <code>&quot;treated&quot;</code> if not specified, and if the estimand is the ATE, <code>s.d.denom</code> will default to <code>&quot;pooled&quot;</code>. The user can specify their own argument to <code>s.d.denom</code>, but using the defaults is advisable.</p>
<p>When using <code>CBPS</code> and <code>bal.tab()</code> with continuous treatments, the same guidelines apply as when using <code>bal.tab()</code> with continuous treatments without a conditioning package. See the section “Using cobalt with continuous treatments” in the main vignette for more details.</p>
<p><code>CBPSContinuous</code> objects resulting from fitting models in <code>CBPS</code> with continuous treatments are also compatible with <code>cobalt</code>. See the section “Using <code>cobalt</code> with continuous treatments” in the main vignette. <code>CBPS</code> objects resulting from fitting models in <code>CBPS</code> with multi-category treatments are also compatible with <code>cobalt</code>. See the section “Using <code>cobalt</code> with multi-category treatments” in the main vignette. <code>CBMSM</code> objects resulting from fitting models in <code>CBPS</code> with longitudinal treatments are also compatible with <code>cobalt</code>. See the Appendix 3 vignette.</p>
</div>
<div id="using-bal.tab-with-ebal" class="section level3">
<h3>Using <code>bal.tab()</code> with <code>ebal</code></h3>
<p>The <code>ebal</code> package implements entropy balancing, a method of weighting for the ATT that yields perfect balance on all desired moments of the covariate distributions between groups. Rather than estimate a propensity score, entropy balancing generates weights directly that satisfy a user-defined moment condition, specifying which moments are to be balanced. Not that all the functionality of <code>ebal</code> is contained within <code>Weightit</code>. <code>ebal</code> does not have its own balance assessment function; thus, <code>cobalt</code> is the only way to assess balance without programming, which the <code>ebal</code> documentation instructs. Below is a simple example of using <code>bal.tab()</code> with <code>ebal</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">library</span>(<span class="st">&quot;ebal&quot;</span>)</span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="kw">data</span>(<span class="st">&quot;lalonde&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;cobalt&quot;</span>) <span class="co">#If not yet loaded</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>covs0 &lt;-<span class="st"> </span><span class="kw">subset</span>(lalonde, <span class="dt">select =</span> <span class="op">-</span><span class="kw">c</span>(treat, re78, race))</span>
<span id="cb18-4"><a href="#cb18-4"></a></span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="co">#Generating entropy balancing weights</span></span>
<span id="cb18-6"><a href="#cb18-6"></a>e.out &lt;-<span class="st"> </span><span class="kw">ebalance</span>(lalonde<span class="op">$</span>treat, covs0)</span></code></pre></div>
<pre><code>## Converged within tolerance</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw">bal.tab</span>(e.out, <span class="dt">treat =</span> lalonde<span class="op">$</span>treat, <span class="dt">covs =</span> covs0)</span></code></pre></div>
<pre><code>## Balance Measures
##             Type Diff.Adj
## age      Contin.       -0
## educ     Contin.       -0
## married   Binary       -0
## nodegree  Binary        0
## re74     Contin.       -0
## re75     Contin.       -0
## 
## Effective sample sizes
##            Control Treated
## Unadjusted  429.       185
## Adjusted    247.64     185</code></pre>
<p>First is the balance table containing mean differences for covariates included in the original call to <code>ebalance</code>. In general, these will all be very close to 0. Next is a table displaying effective sample size information. The “effective” sample size is calculated as is done in <code>twang</code>. See the <code>twang</code> documentation, <code>?bal.tab</code>, or “Details on Calculations” in the main vignette for details on this calculation. A common issue when using entropy balancing is small effective sample size, which can yield low precision in effect estimation when using weighted regression, so it is important that users pay attention to this measure.</p>
<p>The input is similar to that for using <code>bal.tab()</code> with <code>Matching</code> or <code>optmatch</code>. In addition to the <code>ebalance</code> object, one must specify either both a formula and a data set or both a treatment vector and a data frame of covariates.</p>
</div>
<div id="using-bal.tab-with-designmatch" class="section level3">
<h3>Using <code>bal.tab()</code> with <code>designmatch</code></h3>
<p>The <code>designmatch</code> package implements various matching methods that use optimization to find matches that satisfy certain balance constraints. <code>bal.tab()</code> functions similarly to <code>designmatch</code>’s <code>meantab()</code> command but provides additional flexibility and convenience. Below is a simple example of using <code>bal.tab()</code> with <code>designmatch</code>:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw">library</span>(<span class="st">&quot;designmatch&quot;</span>)</span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="kw">data</span>(<span class="st">&quot;lalonde&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;cobalt&quot;</span>) <span class="co">#If not yet loaded</span></span>
<span id="cb22-3"><a href="#cb22-3"></a>covs0 &lt;-<span class="st"> </span><span class="kw">subset</span>(lalonde, <span class="dt">select =</span> <span class="op">-</span><span class="kw">c</span>(treat, re78, race))</span>
<span id="cb22-4"><a href="#cb22-4"></a></span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="co">#Matching for balance on covariates</span></span>
<span id="cb22-6"><a href="#cb22-6"></a>dmout &lt;-<span class="st"> </span><span class="kw">bmatch</span>(lalonde<span class="op">$</span>treat,</span>
<span id="cb22-7"><a href="#cb22-7"></a>                <span class="dt">dist_mat =</span> <span class="ot">NULL</span>,</span>
<span id="cb22-8"><a href="#cb22-8"></a>                <span class="dt">subset_weight =</span> <span class="ot">NULL</span>,</span>
<span id="cb22-9"><a href="#cb22-9"></a>                <span class="dt">mom =</span> <span class="kw">list</span>(<span class="dt">covs =</span> covs0,</span>
<span id="cb22-10"><a href="#cb22-10"></a>                           <span class="dt">tols =</span> <span class="kw">absstddif</span>(covs0, lalonde<span class="op">$</span>treat, <span class="fl">.005</span>)),</span>
<span id="cb22-11"><a href="#cb22-11"></a>                <span class="dt">n_controls =</span> <span class="dv">1</span>,</span>
<span id="cb22-12"><a href="#cb22-12"></a>                <span class="dt">total_groups =</span> <span class="dv">185</span>)</span></code></pre></div>
<pre><code>##   Building the matching problem... 
##   GLPK optimizer is open... 
##   Finding the optimal matches... 
##   Optimal matches found</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="kw">bal.tab</span>(dmout, <span class="dt">treat =</span> lalonde<span class="op">$</span>treat, <span class="dt">covs =</span> covs0)</span></code></pre></div>
<pre><code>## Balance Measures
##             Type Diff.Adj
## age      Contin.   0.0038
## educ     Contin.   0.0054
## married   Binary   0.0000
## nodegree  Binary   0.0054
## re74     Contin.  -0.0120
## re75     Contin.  -0.0076
## 
## Sample sizes
##           Control Treated
## All           429     185
## Matched       185     185
## Unmatched     244       0</code></pre>
<p>The input is similar to that for using <code>bal.tab()</code> with <code>Matching</code> or <code>optmatch</code>. In addition to the <code>designmatch()</code> output object, one must specify either both a formula and a data set or both a treatment vector and a data frame of covariates. The output is similar to that of <code>optmatch</code>.</p>
</div>
<div id="using-bal.tab-with-sbw" class="section level3">
<h3>Using <code>bal.tab()</code> with <code>sbw</code></h3>
<p>The <code>sbw</code> package implements optimization-based weighting to estimate weights that satisfy certain balance constraints and have minimal variance. <code>bal.tab()</code> functions similarly to <code>sbw</code>’s <code>summarize()</code> function but provides additional flexibility and convenience. Below is a simple example of using <code>bal.tab()</code> with <code>sbw</code>:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw">library</span>(<span class="st">&quot;sbw&quot;</span>)</span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="kw">data</span>(<span class="st">&quot;lalonde&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;cobalt&quot;</span>) <span class="co">#If not yet loaded</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>lalonde_split &lt;-<span class="st"> </span><span class="kw">splitfactor</span>(lalonde, <span class="dt">drop.first =</span> <span class="st">&quot;if2&quot;</span>)</span>
<span id="cb26-4"><a href="#cb26-4"></a>cov.names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;educ&quot;</span>, <span class="st">&quot;race_black&quot;</span>, <span class="st">&quot;race_hispan&quot;</span>, </span>
<span id="cb26-5"><a href="#cb26-5"></a>               <span class="st">&quot;race_white&quot;</span>, <span class="st">&quot;married&quot;</span>, <span class="st">&quot;nodegree&quot;</span>, </span>
<span id="cb26-6"><a href="#cb26-6"></a>               <span class="st">&quot;re74&quot;</span>, <span class="st">&quot;re75&quot;</span>)</span>
<span id="cb26-7"><a href="#cb26-7"></a></span>
<span id="cb26-8"><a href="#cb26-8"></a><span class="co">#Estimating balancing weights for the ATT</span></span>
<span id="cb26-9"><a href="#cb26-9"></a>sbw.out &lt;-<span class="st"> </span><span class="kw">sbw</span>(lalonde_split,</span>
<span id="cb26-10"><a href="#cb26-10"></a>               <span class="dt">ind =</span> <span class="st">&quot;treat&quot;</span>,</span>
<span id="cb26-11"><a href="#cb26-11"></a>               <span class="dt">bal =</span> <span class="kw">list</span>(<span class="dt">bal_cov =</span> cov.names,</span>
<span id="cb26-12"><a href="#cb26-12"></a>                          <span class="dt">bal_alg =</span> <span class="ot">FALSE</span>, </span>
<span id="cb26-13"><a href="#cb26-13"></a>                          <span class="dt">bal_tol =</span> <span class="fl">.001</span>),</span>
<span id="cb26-14"><a href="#cb26-14"></a>               <span class="dt">par =</span> <span class="kw">list</span>(<span class="dt">par_est =</span> <span class="st">&quot;att&quot;</span>))</span></code></pre></div>
<pre><code>##   quadprog optimizer is opening... 
##   Finding the optimal weights... 
##   Optimal weights found.</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="kw">bal.tab</span>(sbw.out, <span class="dt">un =</span> <span class="ot">TRUE</span>, <span class="dt">disp.means =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## Balance Measures
##                Type    M.0.Un    M.1.Un Diff.Un   M.0.Adj   M.1.Adj Diff.Adj
## age         Contin.   28.0303   25.8162 -0.3094   25.8054   25.8162   0.0015
## educ        Contin.   10.2354   10.3459  0.0550   10.3431   10.3459   0.0014
## race_black   Binary    0.2028    0.8432  0.6404    0.8428    0.8432   0.0004
## race_hispan  Binary    0.1422    0.0595 -0.0827    0.0594    0.0595   0.0001
## race_white   Binary    0.6550    0.0973 -0.5577    0.0978    0.0973  -0.0005
## married      Binary    0.5128    0.1892 -0.3236    0.1897    0.1892  -0.0005
## nodegree     Binary    0.5967    0.7081  0.1114    0.7076    0.7081   0.0005
## re74        Contin. 5619.2365 2095.5737 -0.7211 2102.3624 2095.5737  -0.0014
## re75        Contin. 2466.4844 1532.0553 -0.2903 1528.7633 1532.0553   0.0010
## 
## Effective sample sizes
##            Control Treated
## Unadjusted  429.       185
## Adjusted    108.99     185</code></pre>
<p>The output is similar to the output of a call to <code>summarize()</code>. Rather than stack several balance tables vertically, each with their own balance summary, here they are displayed horizontally. Note that due to differences in how <code>sbw</code> and <code>cobalt</code> compute the standardization factor in the standardized mean difference, values may not be identical between <code>bal.tab()</code> and <code>summarize()</code>. Also note that <code>bal.tab()</code>’s default is to display raw rather than standardized mean differences for binary variables.</p>
</div>
<div id="using-bal.tab-with-matchthem" class="section level3">
<h3>Using <code>bal.tab()</code> with <code>MatchThem</code></h3>
<p>The <code>MatchThem</code> package is essentially a wrapper for <code>matchit()</code> from <code>MatchIt</code> and <code>weightit()</code> from <code>WeightIt</code> but for use with multiply imputed data. Using <code>bal.tab()</code> on <code>mimids</code> or <code>wimids</code> objects from <code>MatchThem</code> activates the features that accompany multiply imputed data; balance is assessed within each imputed dataset and aggregated across imputations. See <code>?bal.tab.imp</code> or the accompanying Appendix 2 for more information about using <code>cobalt</code> with multiply imputed data. Below is a simple example of using <code>bal.tab()</code> with <code>MatchThem</code>:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="kw">library</span>(<span class="st">&quot;mice&quot;</span>); <span class="kw">library</span>(<span class="st">&quot;MatchThem&quot;</span>)</span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="kw">data</span>(<span class="st">&quot;lalonde_mis&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;cobalt&quot;</span>)</span>
<span id="cb30-3"><a href="#cb30-3"></a></span>
<span id="cb30-4"><a href="#cb30-4"></a><span class="co">#Generate imputed data sets</span></span>
<span id="cb30-5"><a href="#cb30-5"></a>m &lt;-<span class="st"> </span><span class="dv">10</span> <span class="co">#number of imputed data sets</span></span>
<span id="cb30-6"><a href="#cb30-6"></a>imp.out &lt;-<span class="st"> </span><span class="kw">mice</span>(lalonde_mis, <span class="dt">m =</span> m, <span class="dt">print =</span> <span class="ot">FALSE</span>) </span>
<span id="cb30-7"><a href="#cb30-7"></a></span>
<span id="cb30-8"><a href="#cb30-8"></a><span class="co">#Matching for balance on covariates</span></span>
<span id="cb30-9"><a href="#cb30-9"></a>wt.out &lt;-<span class="st"> </span><span class="kw">weightthem</span>(treat <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>educ <span class="op">+</span><span class="st"> </span>married <span class="op">+</span></span>
<span id="cb30-10"><a href="#cb30-10"></a><span class="st">                       </span>race <span class="op">+</span><span class="st"> </span>re74 <span class="op">+</span><span class="st"> </span>re75, </span>
<span id="cb30-11"><a href="#cb30-11"></a>                     <span class="dt">datasets =</span> imp.out,</span>
<span id="cb30-12"><a href="#cb30-12"></a>                     <span class="dt">approach =</span> <span class="st">&quot;within&quot;</span>, </span>
<span id="cb30-13"><a href="#cb30-13"></a>                     <span class="dt">method =</span> <span class="st">&quot;ps&quot;</span>,</span>
<span id="cb30-14"><a href="#cb30-14"></a>                     <span class="dt">estimand =</span> <span class="st">&quot;ATE&quot;</span>)</span></code></pre></div>
<pre><code>## Estimating weights     | dataset: #1 #2 #3 #4 #5 #6 #7 #8 #9 #10</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="kw">bal.tab</span>(wt.out)</span></code></pre></div>
<pre><code>## Balance summary across all imputations
##                 Type Min.Diff.Adj Mean.Diff.Adj Max.Diff.Adj
## prop.score  Distance       0.1412        0.1552       0.1680
## age          Contin.      -0.1955       -0.1894      -0.1827
## educ         Contin.       0.0736        0.0816       0.0932
## married       Binary      -0.1075       -0.1009      -0.0909
## race_black    Binary       0.0500        0.0559       0.0620
## race_hispan   Binary       0.0074        0.0104       0.0136
## race_white    Binary      -0.0743       -0.0663      -0.0585
## re74         Contin.      -0.3047       -0.2901      -0.2780
## re75         Contin.      -0.1697       -0.1536      -0.1365
## 
## Average effective sample sizes across imputations
##            Control Treated
## Unadjusted   429.   185.  
## Adjusted     331.6   66.83</code></pre>
<p>The input is similar to that for using <code>bal.tab()</code> with <code>MatchIt</code> or <code>WeightIt</code>.</p>
</div>
<div id="using-bal.tab-with-cem" class="section level3">
<h3>Using <code>bal.tab()</code> with <code>cem</code></h3>
<p>The <code>cem</code> package implements coarsened exact matching for binary and multi-category treatments. <code>bal.tab()</code> functions similarly to <code>cems</code>’s <code>imbalance()</code>. Below is a simple example of using <code>bal.tab()</code> with <code>cem</code>:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="kw">library</span>(<span class="st">&quot;cem&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in fun(libname, pkgname): couldn&#39;t connect to display &quot;:0&quot;</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="kw">data</span>(<span class="st">&quot;lalonde&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;cobalt&quot;</span>) <span class="co">#If not yet loaded</span></span>
<span id="cb36-2"><a href="#cb36-2"></a></span>
<span id="cb36-3"><a href="#cb36-3"></a><span class="co">#Matching for balance on covariates</span></span>
<span id="cb36-4"><a href="#cb36-4"></a>cem.out &lt;-<span class="st"> </span><span class="kw">cem</span>(<span class="st">&quot;treat&quot;</span>, <span class="dt">data =</span> lalonde, <span class="dt">drop =</span> <span class="st">&quot;re78&quot;</span>)</span>
<span id="cb36-5"><a href="#cb36-5"></a></span>
<span id="cb36-6"><a href="#cb36-6"></a><span class="kw">bal.tab</span>(cem.out, <span class="dt">data =</span> lalonde, <span class="dt">stats =</span> <span class="kw">c</span>(<span class="st">&quot;m&quot;</span>, <span class="st">&quot;ks&quot;</span>))</span></code></pre></div>
<pre><code>## Balance Measures
##                Type Diff.Adj KS.Adj
## age         Contin.   0.0512 0.1581
## educ        Contin.  -0.0441 0.0445
## race_black   Binary   0.0000 0.0000
## race_hispan  Binary   0.0000 0.0000
## race_white   Binary   0.0000 0.0000
## married      Binary   0.0000 0.0000
## nodegree     Binary   0.0000 0.0000
## re74        Contin.  -0.0341 0.2418
## re75        Contin.  -0.0528 0.1162
## 
## Sample sizes
##                      Control Treated
## All                   429.       185
## Matched (ESS)          36.29      68
## Matched (Unweighted)   78.        68
## Unmatched             351.       117</code></pre>
<p>The input is similar to that for using <code>bal.tab()</code> with <code>Matching</code> or <code>optmatch</code>. In addition to the <code>cem()</code> output object, one must specify either both a formula and a data set or both a treatment vector and a data frame of covariates. Unlike with <code>Matching</code>, entering the treatment variable is optional as it is already stored in the output object. The output is similar to that of <code>optmatch</code>.</p>
<p>When using <code>cem()</code> with multiply imputed data (i.e., by supplying a list of data.frames to the <code>datalist</code> argument in <code>cem()</code>), an argument to <code>imp</code> should be specified to <code>bal.tab()</code> or a <code>mids</code> object from the <code>mice</code> package should be given as the argument to <code>data</code>. See <code>?bal.tab.imp</code> or the accompanying Appendix 2 for more information about using <code>cobalt</code> with multiply imputed data. Below is an example of using <code>cem</code> with multiply imputed data from <code>mice</code>:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="kw">library</span>(<span class="st">&quot;mice&quot;</span>); <span class="kw">library</span>(<span class="st">&quot;cem&quot;</span>)</span>
<span id="cb38-2"><a href="#cb38-2"></a><span class="kw">data</span>(<span class="st">&quot;lalonde_mis&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;cobalt&quot;</span>)</span>
<span id="cb38-3"><a href="#cb38-3"></a></span>
<span id="cb38-4"><a href="#cb38-4"></a><span class="co">#Generate imputed data sets</span></span>
<span id="cb38-5"><a href="#cb38-5"></a>m &lt;-<span class="st"> </span><span class="dv">10</span> <span class="co">#number of imputed data sets</span></span>
<span id="cb38-6"><a href="#cb38-6"></a>imp.out &lt;-<span class="st"> </span><span class="kw">mice</span>(lalonde_mis, <span class="dt">m =</span> m, <span class="dt">print =</span> <span class="ot">FALSE</span>) </span>
<span id="cb38-7"><a href="#cb38-7"></a>imp.data.list &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span>m, complete, <span class="dt">data =</span> imp.out)</span>
<span id="cb38-8"><a href="#cb38-8"></a></span>
<span id="cb38-9"><a href="#cb38-9"></a><span class="co">#Match within each imputed dataset</span></span>
<span id="cb38-10"><a href="#cb38-10"></a>cem.out.imp &lt;-<span class="st"> </span><span class="kw">cem</span>(<span class="st">&quot;treat&quot;</span>, <span class="dt">datalist =</span> imp.data.list, <span class="dt">drop =</span> <span class="st">&quot;re78&quot;</span>)</span>
<span id="cb38-11"><a href="#cb38-11"></a></span>
<span id="cb38-12"><a href="#cb38-12"></a><span class="kw">bal.tab</span>(cem.out.imp, <span class="dt">data =</span> imp.out)</span></code></pre></div>
<pre><code>## Balance summary across all imputations
##                Type Min.Diff.Adj Mean.Diff.Adj Max.Diff.Adj
## age         Contin.       0.0411        0.0487       0.0553
## educ        Contin.      -0.0447       -0.0374      -0.0306
## race_black   Binary      -0.0000       -0.0000       0.0000
## race_hispan  Binary      -0.0000        0.0000       0.0000
## race_white   Binary      -0.0000       -0.0000       0.0000
## married      Binary      -0.0000       -0.0000       0.0000
## nodegree     Binary       0.0000        0.0000       0.0000
## re74        Contin.      -0.0420       -0.0368      -0.0321
## re75        Contin.      -0.0948       -0.0572      -0.0394
## 
## Average sample sizes across imputations
##                      Control Treated
## All                   429.     185. 
## Matched (ESS)          35.76    66.6
## Matched (Unweighted)   78.      66.6
## Unmatched             351.     118.4</code></pre>
</div>
<div id="using-bal.tab-with-other-packages" class="section level3">
<h3>Using <code>bal.tab()</code> with other packages</h3>
<p>It is possible to use <code>bal.tab</code> with objects that don’t come from these packages using the <code>default</code> method. If an object that doesn’t correspond to the output from one of the specifically supported packages is passed as the first argument to <code>bal.tab</code>, <code>bal.tab</code> will do its best to process that object as if it did come from a supported package. It will search through the components of the object for items with names like <code>&quot;treat&quot;</code>, <code>&quot;covs&quot;</code>, <code>&quot;data&quot;</code>, <code>&quot;weights&quot;</code>, etc., that have the correct object types. Any additional arguments can be specified by the user.</p>
<p>The goal of the <code>default</code> method is to allow package authors to rely on <code>cobalt</code> as a substitute for any balancing function they might otherwise write. By ensuring compatibility with the <code>default</code> method, package authors can have their users simply supply the output of a compatible function into <code>cobalt</code> functions without having to write a specific method in <code>cobalt</code>. A package author would need to make sure the output of their package contained enough information with correctly named components; if so, <code>cobalt</code> functions can be used as conveniently with the output as it is with specifically supported packages.</p>
<p>Below, we demonstrate this capability with the output of <code>optweight</code>, which performs a version of propensity score weighting using optimization, similar to <code>sbw</code>. No <code>bal.tab</code> method has been written with <code>optweight</code> output in mind; rather, <code>optweight</code> was written to have output compatible with the <code>default</code> method of <code>bal.tab</code>.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="kw">library</span>(<span class="st">&quot;optweight&quot;</span>)</span>
<span id="cb40-2"><a href="#cb40-2"></a><span class="kw">data</span>(<span class="st">&quot;lalonde&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;cobalt&quot;</span>)</span>
<span id="cb40-3"><a href="#cb40-3"></a></span>
<span id="cb40-4"><a href="#cb40-4"></a><span class="co">#Estimate the weights using optimization</span></span>
<span id="cb40-5"><a href="#cb40-5"></a>ow.out &lt;-<span class="st"> </span><span class="kw">optweight</span>(treat <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>educ <span class="op">+</span><span class="st"> </span>married <span class="op">+</span><span class="st"> </span>race <span class="op">+</span><span class="st"> </span>re74 <span class="op">+</span><span class="st"> </span>re75,</span>
<span id="cb40-6"><a href="#cb40-6"></a>                    <span class="dt">data =</span> lalonde, <span class="dt">estimand =</span> <span class="st">&quot;ATE&quot;</span>, <span class="dt">tols =</span> <span class="fl">.01</span>)</span>
<span id="cb40-7"><a href="#cb40-7"></a></span>
<span id="cb40-8"><a href="#cb40-8"></a><span class="co">#Note the contents of the output object:</span></span>
<span id="cb40-9"><a href="#cb40-9"></a><span class="kw">names</span>(ow.out)</span></code></pre></div>
<pre><code>##  [1] &quot;weights&quot;   &quot;treat&quot;     &quot;covs&quot;      &quot;s.weights&quot; &quot;estimand&quot;  &quot;focal&quot;    
##  [7] &quot;call&quot;      &quot;tols&quot;      &quot;duals&quot;     &quot;info&quot;</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="co">#Use bal.tab() directly on the output</span></span>
<span id="cb42-2"><a href="#cb42-2"></a><span class="kw">bal.tab</span>(ow.out)</span></code></pre></div>
<pre><code>## Call
##  optweight(formula = treat ~ age + educ + married + race + re74 + 
##     re75, data = lalonde, tols = 0.01, estimand = &quot;ATE&quot;)
## 
## Balance Measures
##                Type Diff.Adj
## age         Contin.  -0.0000
## educ        Contin.   0.0100
## married      Binary  -0.0100
## race_black   Binary   0.0100
## race_hispan  Binary  -0.0000
## race_white   Binary  -0.0100
## re74        Contin.  -0.0100
## re75        Contin.   0.0085
## 
## Effective sample sizes
##            Control Treated
## Unadjusted  429.    185.  
## Adjusted    349.42   52.04</code></pre>
<p>The output is treated as output from a specifically supported package. See <code>?bal.tab.default</code> for more details and another example.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
