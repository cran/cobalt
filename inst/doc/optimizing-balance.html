<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Optimizing Tuning Parameters for Balance</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">

div.csl-bib-body { }
div.csl-entry {
clear: both;
}
.hanging div.csl-entry {
margin-left:2em;
text-indent:-2em;
}
div.csl-left-margin {
min-width:2em;
float:left;
}
div.csl-right-inline {
margin-left:2em;
padding-left:1em;
}
div.csl-indent {
margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Optimizing Tuning Parameters for
Balance</h1>


<div id="TOC">
<ul>
<li><a href="#bal.compute-and-bal.init" id="toc-bal.compute-and-bal.init"><code>bal.compute()</code> and
<code>bal.init()</code></a></li>
<li><a href="#balance-statistics" id="toc-balance-statistics">Balance
statistics</a>
<ul>
<li><a href="#choosing-a-balance-statistic" id="toc-choosing-a-balance-statistic">Choosing a balance
statistic</a></li>
</ul></li>
<li><a href="#example" id="toc-example">Example</a>
<ul>
<li><a href="#tuning-gbm-for-balance" id="toc-tuning-gbm-for-balance">Tuning GBM for balance</a></li>
</ul></li>
<li><a href="#references" id="toc-references">References</a></li>
</ul>
</div>

<p>Part of using balancing methods, including matching, weighting, and
subclassification, involves specifying a conditioning method, assessing
balance after applying that method, and repeating until satisfactory
balance is achieved. For example, in propensity score score
subclassification, one needs to decide on the number of subclasses to
use, and one way to do so is to try a number of of subclasses, assess
balance after subclassification, try another number of subclasses,
assess balance, and so on. As another example, in estimating the
propensity score model itself, one might decided which covariates to
include in the model (after deciding on a fixed set of covariates to
balance), which covariates should have squares or interactions, and
which link function (e.g., probit, logit) to use. Or choosing the number
of matches each unit should receive in k:1 matching, or which value of
the propensity score should be used to trim samples, etc.</p>
<p>Essentially, these problems all involve selecting a specification by
varying a number of parameters, which are sometimes called “tuning
parameters”, in order to optimize balance. Many popular methods adjust
tuning parameters to optimize balance as inherent parts of the method,
like genetic matching <span class="citation">(<a href="#ref-diamondGeneticMatchingEstimating2013">Diamond and Sekhon
2013</a>)</span>, which tunes variance importance in the distance
matrix, or generalized boosted modeling <span class="citation">(<a href="#ref-mccaffreyPropensityScoreEstimation2004">McCaffrey, Ridgeway,
and Morral 2004</a>)</span>, which tunes the number of trees in the
prediction model for propensity scores. This strategy tends to yield
methods that perform better than methods that don’t tune at all or tune
to optimize a criterion other than balance (e.g., prediction accuracy)
<span class="citation">Pirracchio and Carone (<a href="#ref-pirracchioBalanceSuperLearner2018">2018</a>)</span>.</p>
<p>As of version 4.5.0, <code>cobalt</code> provides the functions
<code>bal.compute()</code> and <code>bal.init()</code> to aid in
selecting these tuning parameters in an efficient way without needing to
manually program the computation of the balance statistic used as the
criterion to optimize. This vignette explains how to use these
functions, describes the balance statistics that are available, and
provides examples of using these functions to implement new and existing
balancing methods yourself. These functions are primarily for use inside
other packages but may be useful to users experimenting with new
methods. For a complete way to assess balance for a single
specification, users should use <code>bal.tab()</code> and
<code>bal.plot()</code> instead.</p>
<div id="bal.compute-and-bal.init" class="section level2">
<h2><code>bal.compute()</code> and <code>bal.init()</code></h2>
<p>Broadly, these functions work by taking in the treatment, covariates
for which balance is to be computed, and a set of balancing weights and
return a scalar balance statistic that summarizes balance for the
sample. <code>bal.compute()</code> does the work of computing the
balance statistic, and <code>bal.init()</code> processes the inputs so
they don’t need to be processed every time <code>bal.compute()</code> is
called with a new set of weights.</p>
<p>For <code>bal.init()</code>, we need to supply the covariates, the
treatment, the name of the balance statistic we wish to compute,
sampling weights (if any), and any other inputs required, which depend
on the specific balance statistic requested. <code>bal.init()</code>
returns a <code>bal.init</code> object, which is then passed to
<code>bal.compute()</code> along with a set of balancing weights (which
may result from weighting, matching, or subclassification).</p>
<p>Below, we provide an example using the <code>lalonde</code> dataset.
Our balance statistic will be the largest absolute standardized mean
difference among the included covariates, which is specified as
<code>&quot;smd.max&quot;</code>. We will first supply the required inputs to
<code>bal.init()</code> and pass its output to
<code>bal.compute()</code> to compute the balance statistic for the
sample prior to weighting.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(cobalt)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;lalonde&quot;</span>, <span class="at">package =</span> <span class="st">&quot;cobalt&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>covs <span class="ot">&lt;-</span> <span class="fu">subset</span>(lalonde, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(treat, race, re78))</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co"># Initialize the object with the balance statistic,</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co"># treatment, and covariates</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>smd.init <span class="ot">&lt;-</span> <span class="fu">bal.init</span>(covs,</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>                     <span class="at">treat =</span> lalonde<span class="sc">$</span>treat,</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>                     <span class="at">stat =</span> <span class="st">&quot;smd.max&quot;</span>,</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>                     <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>)</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co"># Compute balance with no weights</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="fu">bal.compute</span>(smd.init)</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="co">#&gt; [1] 0.8263093</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="co"># Can also compute the statistic directly using bal.compute():</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="fu">bal.compute</span>(covs,</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>            <span class="at">treat =</span> lalonde<span class="sc">$</span>treat,</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>            <span class="at">stat =</span> <span class="st">&quot;smd.max&quot;</span>,</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>            <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>)</span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="co">#&gt; [1] 0.8263093</span></span></code></pre></div>
<p>The largest absolute standardized mean difference with no weights is
0.8263, which we can verify and investigate further using
<code>bal.tab()</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">bal.tab</span>(covs,</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>        <span class="at">treat =</span> lalonde<span class="sc">$</span>treat,</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>        <span class="at">binary =</span> <span class="st">&quot;std&quot;</span>,</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>        <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>,</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>        <span class="at">thresholds =</span> .<span class="dv">05</span>)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#&gt; Balance Measures</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt;             Type Diff.Un      M.Threshold.Un</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt; age      Contin. -0.3094 Not Balanced, &gt;0.05</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">#&gt; educ     Contin.  0.0550 Not Balanced, &gt;0.05</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">#&gt; married   Binary -0.8263 Not Balanced, &gt;0.05</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co">#&gt; nodegree  Binary  0.2450 Not Balanced, &gt;0.05</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="co">#&gt; re74     Contin. -0.7211 Not Balanced, &gt;0.05</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co">#&gt; re75     Contin. -0.2903 Not Balanced, &gt;0.05</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co">#&gt; Balance tally for mean differences</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co">#&gt;                     count</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="co">#&gt; Balanced, &lt;0.05         0</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="co">#&gt; Not Balanced, &gt;0.05     6</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a><span class="co">#&gt; Variable with the greatest mean difference</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="co">#&gt;  Variable Diff.Un      M.Threshold.Un</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a><span class="co">#&gt;   married -0.8263 Not Balanced, &gt;0.05</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a><span class="co">#&gt; Sample sizes</span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a><span class="co">#&gt;     Control Treated</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a><span class="co">#&gt; All     429     185</span></span></code></pre></div>
<p>We can see that the largest value corresponds to the covariate
<code>married</code>.</p>
<p>Now, lets estimate weights using probit regression propensity scores
in <code>WeightIt</code> and see whether this balance statistic
decreases after applying the weights:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;WeightIt&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>w.out <span class="ot">&lt;-</span> <span class="fu">weightit</span>(treat <span class="sc">~</span> age <span class="sc">+</span> educ <span class="sc">+</span> married <span class="sc">+</span> nodegree <span class="sc">+</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>                      re74 <span class="sc">+</span> re75, <span class="at">data =</span> lalonde,</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>                  <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>,</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>                  <span class="at">link =</span> <span class="st">&quot;probit&quot;</span>)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co"># Compute the balance statistic on the estimated weights</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="fu">bal.compute</span>(smd.init, <span class="fu">get.w</span>(w.out))</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt; [1] 0.06936946</span></span></code></pre></div>
<p>After weighting, our balance statistic is 0.0694, indicating a
significant improvement. Let’s try again with logistic regression:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>w.out <span class="ot">&lt;-</span> <span class="fu">weightit</span>(treat <span class="sc">~</span> age <span class="sc">+</span> educ <span class="sc">+</span> married <span class="sc">+</span> nodegree <span class="sc">+</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>                      re74 <span class="sc">+</span> re75, <span class="at">data =</span> lalonde,</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>                  <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>,</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>                  <span class="at">link =</span> <span class="st">&quot;logit&quot;</span>)</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co"># Compute the balance statistic on the estimated weights</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="fu">bal.compute</span>(smd.init, <span class="fu">get.w</span>(w.out))</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt; [1] 0.04791925</span></span></code></pre></div>
<p>This is better, but we can do even better with bias-reduced logistic
regression <span class="citation">(<a href="#ref-kosmidis2020">Kosmidis
and Firth 2020</a>)</span>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>w.out <span class="ot">&lt;-</span> <span class="fu">weightit</span>(treat <span class="sc">~</span> age <span class="sc">+</span> educ <span class="sc">+</span> married <span class="sc">+</span> nodegree <span class="sc">+</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>                      re74 <span class="sc">+</span> re75, <span class="at">data =</span> lalonde,</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>                  <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>,</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>                  <span class="at">link =</span> <span class="st">&quot;br.logit&quot;</span>)</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co"># Compute the balance statistic on the estimated weights</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="fu">bal.compute</span>(smd.init, <span class="fu">get.w</span>(w.out))</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt; [1] 0.04392724</span></span></code></pre></div>
<p>Instead of writing each complete call one at a time, we can do a
little programming to make this happen automatically:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Initialize object to compute the largest SMD</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>smd.init <span class="ot">&lt;-</span> <span class="fu">bal.init</span>(covs,</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>                     <span class="at">treat =</span> lalonde<span class="sc">$</span>treat,</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>                     <span class="at">stat =</span> <span class="st">&quot;smd.max&quot;</span>,</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>                     <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>)</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co"># Create vector of tuning parameters</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>links <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;probit&quot;</span>, <span class="st">&quot;logit&quot;</span>, <span class="st">&quot;cloglog&quot;</span>,</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>           <span class="st">&quot;br.probit&quot;</span>, <span class="st">&quot;br.logit&quot;</span>, <span class="st">&quot;br.cloglog&quot;</span>)</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co"># Apply each link to estimate weights</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co"># Can replace sapply() with purrr::map()</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>weights.list <span class="ot">&lt;-</span> <span class="fu">sapply</span>(links, <span class="cf">function</span>(link) {</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>    w.out <span class="ot">&lt;-</span> <span class="fu">weightit</span>(treat <span class="sc">~</span> age <span class="sc">+</span> educ <span class="sc">+</span> married <span class="sc">+</span> nodegree <span class="sc">+</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>                      re74 <span class="sc">+</span> re75, <span class="at">data =</span> lalonde,</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>                  <span class="at">method =</span> <span class="st">&quot;glm&quot;</span>, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>,</span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>                  <span class="at">link =</span> link)</span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>    <span class="fu">get.w</span>(w.out)</span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>}, <span class="at">simplify =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a><span class="co"># Use each set of weights to compute balance</span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a><span class="co"># Can replace sapply() with purrr:map_vec()</span></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a>stats <span class="ot">&lt;-</span> <span class="fu">sapply</span>(weights.list, bal.compute,</span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a>                <span class="at">x =</span> smd.init)</span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a><span class="co"># See which set of weights is the best</span></span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a>stats</span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a><span class="co">#&gt;     probit      logit    cloglog  br.probit   br.logit br.cloglog </span></span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a><span class="co">#&gt; 0.06936946 0.04791925 0.02726102 0.06444577 0.04392724 0.02457557</span></span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a>stats[<span class="fu">which.min</span>(stats)]</span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a><span class="co">#&gt; br.cloglog </span></span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a><span class="co">#&gt; 0.02457557</span></span></code></pre></div>
<p>Interestingly, bias-reduced complimentary log-log regression produced
weights with the smallest maximum absolute standardized mean difference.
We can use <code>bal.tab()</code> to more finely examine balance on the
chosen weights:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">bal.tab</span>(covs,</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>        <span class="at">treat =</span> lalonde<span class="sc">$</span>treat,</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>        <span class="at">binary =</span> <span class="st">&quot;std&quot;</span>,</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>        <span class="at">weights =</span> weights.list[[<span class="st">&quot;br.cloglog&quot;</span>]])</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt; Balance Measures</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt;             Type Diff.Adj</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt; age      Contin.  -0.0089</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; educ     Contin.  -0.0246</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt; married   Binary  -0.0012</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#&gt; nodegree  Binary   0.0145</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt; re74     Contin.  -0.0209</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt; re75     Contin.  -0.0213</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co">#&gt; Effective sample sizes</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co">#&gt;            Control Treated</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co">#&gt; Unadjusted  429.       185</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="co">#&gt; Adjusted    240.83     185</span></span></code></pre></div>
<p>If balance is acceptable, you would move forward with these weights
in estimating the treatment effect. Otherwise, you might try other
values of the tuning parameters, other specifications of the model, or
other weighting methods to try to achieve excellent balance.</p>
</div>
<div id="balance-statistics" class="section level2">
<h2>Balance statistics</h2>
<p>Several balance statistics can be computed by
<code>bal.compute()</code> and <code>bal.init()</code>, and the ones
available depend on whether the treatment is binary, multi-category, or
continuous. These are explained below and on the help page
<code>?bal.compute</code>. A complete list for a given treatment type
can be requested using <code>available.stats()</code>. Some balance
statistics are appended with <code>&quot;.mean&quot;</code>, <code>&quot;.max&quot;</code>,
or <code>&quot;.rms&quot;</code>, which correspond to the mean (or L1-norm),
maximum (or L-infinity norm), and root mean square (or L2-norm) of the
absolute univariate balance statistic computed for each covariate.</p>
<div id="smd.mean-smd.max-smd.rms" class="section level4">
<h4><code>smd.mean</code>, <code>smd.max</code>,
<code>smd.rms</code></h4>
<p>The mean, maximum, and root mean square of the absolute standardized
mean differences computed for the covariates using
<code>col_w_smd()</code>. The other allowable arguments include
<code>estimand</code> (ATE, ATC, or ATT) to select the estimand,
<code>focal</code> to identify the focal treatment group when the ATT is
the estimand and the treatment has more than two categories, and
<code>pairwise</code> to select whether mean differences should be
computed between each pair of treatment groups or between each treatment
group and the target group identified by <code>estimand</code> (default
<code>TRUE</code>). Can be used with binary and multi-category
treatments.</p>
</div>
<div id="ks.mean-ks.max-ks.rms" class="section level4">
<h4><code>ks.mean</code>, <code>ks.max</code>, <code>ks.rms</code></h4>
<p>The mean, maximum, or root-mean-squared Kolmogorov-Smirnov statistic,
computed using <code>col_w_ks()</code>. The other allowable arguments
include <code>estimand</code> (ATE, ATC, or ATT) to select the estimand,
<code>focal</code> to identify the focal treatment group when the ATT is
the estimand and the treatment has more than two categories, and
<code>pairwise</code> to select whether statistics should be computed
between each pair of treatment groups or between each treatment group
and the target group identified by <code>estimand</code> (default
<code>TRUE</code>). Can be used with binary and multi-category
treatments.</p>
</div>
<div id="ovl.mean-ovl.max-ovl.rms" class="section level4">
<h4><code>ovl.mean</code>, <code>ovl.max</code>,
<code>ovl.rms</code></h4>
<p>The mean, maximum, or root-mean-squared overlapping coefficient
compliment, computed using <code>col_w_ovl()</code>. The other allowable
arguments include <code>estimand</code> (ATE, ATC, or ATT) to select the
estimand, <code>focal</code> to identify the focal treatment group when
the ATT is the estimand and the treatment has more than two categories,
and <code>pairwise</code> to select whether statistics should be
computed between each pair of treatment groups or between each treatment
group and the target group identified by <code>estimand</code> (default
<code>TRUE</code>). Can be used with binary and multi-category
treatments.</p>
</div>
<div id="mahalanobis" class="section level4">
<h4><code>mahalanobis</code></h4>
<p>The Mahalanobis distance between the treatment group means, which is
computed as <span class="math display">\[
\sqrt{(\mathbf{\bar{x}}_1 - \mathbf{\bar{x}}_0) \Sigma^{-1}
(\mathbf{\bar{x}}_1 - \mathbf{\bar{x}}_0)}
\]</span> where <span class="math inline">\(\mathbf{\bar{x}}_1\)</span>
and <span class="math inline">\(\mathbf{\bar{x}}_0\)</span> are the
vectors of covariate means in the two treatment groups, <span class="math inline">\(\Sigma^-1\)</span> is the (generalized) inverse of
the covariance matrix of the covariates <span class="citation">(<a href="#ref-franklinMetricsCovariateBalance2014">Franklin et al.
2014</a>)</span>. This is similar to <code>&quot;smd.rms&quot;</code> but the
covariates are standardized to remove correlations between and
de-emphasize redundant covariates. The other allowable arguments include
<code>estimand</code> (ATE, ATC, or ATT) to select the estimand, which
determines how the covariance matrix is calculated, and
<code>focal</code> to identify the focal treatment group when the ATT is
the estimand. Can only be used with binary treatments.</p>
</div>
<div id="energy.dist" class="section level4">
<h4><code>energy.dist</code></h4>
<p>The total energy distance between each treatment group and the target
sample, which is a scalar measure of the similarity between two
multivariate distributions. See <span class="citation">Huling and Mak
(<a href="#ref-hulingEnergyBalancingCovariate2022">2022</a>)</span> for
details. The other allowable arguments include <code>estimand</code>
(ATE, ATC, or ATT) to select the estimand, <code>focal</code> to
identify the focal treatment group when the ATT is the estimand and the
treatment has more than two categories, and <code>improved</code> to
select whether the “improved” energy distance should be used, which
emphasizes difference between treatment groups in addition to difference
between each treatment group and the target sample (default
<code>TRUE</code>). Can be used with binary and multi-category
treatments.</p>
</div>
<div id="kernel.dist" class="section level4">
<h4><code>kernel.dist</code></h4>
<p>The kernel distance between treatment groups, which is a scalar
measure of the similarity between two multivariate distributions. See
<span class="citation">Zhu, Savage, and Ghosh (<a href="#ref-zhuKernelBasedMetricBalance2018">2018</a>)</span> for
details. Can only be used with binary treatments.</p>
</div>
<div id="l1.med" class="section level4">
<h4><code>l1.med</code></h4>
<p>The median L1 statistic computed across a random selection of
possible coarsening of the data. See <span class="citation">Iacus, King,
and Porro (<a href="#ref-iacusMultivariateMatchingMethods2011">2011</a>)</span> for
details. The other allowable arguments include <code>l1.min.bin</code>
(default 2) and <code>l1.max.bin</code> default (12) to select the
minimum and maximum number of bins with which to bin continuous
variables and <code>l1.n</code> (default 101) to select the number of
binnings used to select the binning at the median. <code>covs</code>
should be supplied without splitting factors into dummies to ensure the
binning works correctly. Can be used with binary and multi-category
treatments.</p>
</div>
<div id="r2-r2.2-r2.3" class="section level4">
<h4><code>r2</code>, <code>r2.2</code>, <code>r2.3</code></h4>
<p>The post-weighting <span class="math inline">\(R^2\)</span> of a
model for the treatment given the covariates. <span class="citation">Franklin et al. (<a href="#ref-franklinMetricsCovariateBalance2014">2014</a>)</span>
describe a similar but less generalizable metric, the “post-matching
c-statistic”. The other allowable arguments include <code>poly</code> to
add polynomial terms of the supplied order to the model and
<code>int</code> (default <code>FALSE</code>) to add two-way
interactions between covariates into the model. Using
<code>&quot;r2.2&quot;</code> is a shortcut to requesting squares, and using
<code>&quot;r2.3&quot;</code> is a shortcut to requesting cubes. Can be used with
binary and continuous treatments. For binary treatments, the McKelvey
and Zavoina <span class="math inline">\(R^2\)</span> from a logistic
regression is used; for continuous treatments, the <span class="math inline">\(R^2\)</span> from a linear regression is used.</p>
</div>
<div id="p.mean-p.max-p.rms" class="section level4">
<h4><code>p.mean</code>, <code>p.max</code>, <code>p.rms</code></h4>
<p>The mean, maximum, or root-mean-squared absolute Pearson correlation
between the treatment and covariates, computed using
<code>col_w_corr()</code>. Can only be used with continuous
treatments.</p>
</div>
<div id="s.mean-s.max-s.rms" class="section level4">
<h4><code>s.mean</code>, <code>s.max</code>, <code>s.rms</code></h4>
<p>The mean, maximum, or root-mean-squared absolute Spearman correlation
between the treatment and covariates, computed using
<code>col_w_corr()</code>. Can only be used with continuous
treatments.</p>
</div>
<div id="distance.cov" class="section level4">
<h4><code>distance.cov</code></h4>
<p>The distance covariance between the scaled covariates and treatment,
which is a scalar measure of the independence of two possibly
multivariate distributions. See <span class="citation">Huling, Greifer,
and Chen (<a href="#ref-hulingIndependenceWeightsCausal2023a">2023</a>)</span> for
details. Can only be used with continuous treatments.</p>
</div>
<div id="choosing-a-balance-statistic" class="section level3">
<h3>Choosing a balance statistic</h3>
<p>Given all these options, how should one choose? There has been some
research into which yields the best results <span class="citation">(<a href="#ref-franklinMetricsCovariateBalance2014">Franklin et al.
2014</a>; <a href="#ref-griffinChasingBalanceOther2017">Griffin et al.
2017</a>; <a href="#ref-stuartPrognosticScorebasedBalance2013">Stuart,
Lee, and Leacy 2013</a>; <a href="#ref-belitserMeasuringBalanceModel2011">Belitser et al. 2011</a>;
<a href="#ref-parastOptimizingVariancebiasTradeoff2017">Parast et al.
2017</a>)</span>, but the actual performance of each depends on the
unique features of the data and system under study. For example, in the
unlikely case that the true outcome model is linear in the covariates,
using the <code>&quot;smd&quot;</code> or <code>&quot;mahalanobis&quot;</code> statistics
will work well for binary and multi-category treatments. In more
realistic cases, though, every measure has its advantages and
disadvantages.</p>
<p>For binary and multi-category treatments, only
<code>&quot;energy.dist&quot;</code>, <code>&quot;kernel.dist&quot;</code>, and
<code>&quot;L1.med&quot;</code> reflect balance on all features of the joint
covariate distribution, whereas the others summarize across balance
statistics computed for each covariate ignoring the others. Similarly,
for continuous treatments, only <code>&quot;distance.cov&quot;</code> reflects
balance on all features of the joint covariate distribution. Given these
advantages, <code>&quot;energy.dist&quot;</code> and <code>&quot;distance.cov&quot;</code>
are my preferences. That said, other measures are better studied,
possibly more intuitive, and more familiar to a broad audience.</p>
</div>
</div>
<div id="example" class="section level2">
<h2>Example</h2>
<p>In this section, I will provide an example that demonstrates how
these functions could be used to replicate the functionality of existing
packages or develop new methods for optimizing balance. We will use
these functions to replicate the functionality of <code>WeightIt</code>
and <code>twang</code> for estimating propensity score weights for a
binary treatment using generalized boosted modeling (GBM). See
<code>help(&quot;bal.compute&quot;)</code> for another example that optimizes
balance to find the number of subclasses in propensity score
subclassification.</p>
<div id="tuning-gbm-for-balance" class="section level3">
<h3>Tuning GBM for balance</h3>
<p>GBM has many tuning parameters that can be optimized, but the key
parameter is the number of trees to use to calculate the predictions.
<code>WeightIt</code> and <code>twang</code> both implement the methods
described in <span class="citation">McCaffrey, Ridgeway, and Morral (<a href="#ref-mccaffreyPropensityScoreEstimation2004">2004</a>)</span> for
selecting the number of trees using a balance criterion. Here, we will
do so manually both to understand the internals of these functions and
illustrate the uses of <code>bal.compute()</code> and
<code>bal.init()</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;lalonde&quot;</span>)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co"># Initialize balance</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>covs <span class="ot">&lt;-</span> <span class="fu">subset</span>(lalonde, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(treat, re78))</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>ks.init <span class="ot">&lt;-</span> <span class="fu">bal.init</span>(covs,</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>                    <span class="at">treat =</span> lalonde<span class="sc">$</span>treat,</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>                    <span class="at">stat =</span> <span class="st">&quot;ks.max&quot;</span>,</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>                    <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co"># Fit a GBM model using `WeightIt` and `twang` defaults</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>fit <span class="ot">&lt;-</span> gbm<span class="sc">::</span><span class="fu">gbm</span>(treat <span class="sc">~</span> age <span class="sc">+</span> educ <span class="sc">+</span> married <span class="sc">+</span> race <span class="sc">+</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>                    nodegree <span class="sc">+</span> re74 <span class="sc">+</span> re75,</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>                <span class="at">data =</span> lalonde,</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>                <span class="at">distribution =</span> <span class="st">&quot;bernoulli&quot;</span>,</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>                <span class="at">n.trees =</span> <span class="dv">4000</span>, <span class="at">interaction.depth =</span> <span class="dv">3</span>,</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>                <span class="at">shrinkage =</span> .<span class="dv">01</span>, <span class="at">bag.fraction =</span> <span class="dv">1</span>)</span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>trees_to_test <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">4000</span>)</span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a>p.mat <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>,</span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>                 <span class="at">n.trees =</span> trees_to_test)</span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>stats <span class="ot">&lt;-</span> <span class="fu">apply</span>(p.mat, <span class="dv">2</span>, <span class="cf">function</span>(p) {</span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>    <span class="co"># Compute ATT weights</span></span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a>    w <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(lalonde<span class="sc">$</span>treat <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, p<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>p))</span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a>    </span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a>    <span class="fu">bal.compute</span>(ks.init, <span class="at">weights =</span> w)</span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a>})</span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a>stats[<span class="fu">which.min</span>(stats)]</span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a><span class="co">#&gt;       1408 </span></span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a><span class="co">#&gt; 0.09563649</span></span></code></pre></div>
<p>From these results, we see that using 1408 trees gives us the lowest
maximum KS statistic of 0.0956. Out of interest, we can plot the
relationship between the number of trees and our balance statistic to
see what it looks like:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> trees_to_test, <span class="at">y =</span> stats)) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;ks.max&quot;</span>, <span class="at">x =</span> <span class="st">&quot;n.trees&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>Let’s compare this to the output of <code>WeightIt</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;WeightIt&quot;</span>)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>w.out <span class="ot">&lt;-</span> <span class="fu">weightit</span>(treat <span class="sc">~</span> age <span class="sc">+</span> educ <span class="sc">+</span> married <span class="sc">+</span> race <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>                    nodegree <span class="sc">+</span> re74 <span class="sc">+</span> re75,</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>                <span class="at">data =</span> lalonde, <span class="at">estimand =</span> <span class="st">&quot;ATT&quot;</span>,</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>                <span class="at">method =</span> <span class="st">&quot;gbm&quot;</span>, <span class="at">n.trees =</span> <span class="dv">4000</span>,</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>                <span class="at">stop.method =</span> <span class="st">&quot;ks.max&quot;</span>)</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co"># Display the best tree:</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>w.out<span class="sc">$</span>info<span class="sc">$</span>best.tree</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt; [1] 1408</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co"># ks.max from weightit()</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="fu">bal.compute</span>(ks.init, <span class="at">weights =</span> <span class="fu">get.w</span>(w.out))</span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co">#&gt; [1] 0.09563649</span></span></code></pre></div>
<p>We can see that <code>weightit()</code> also selects 1408 trees as
the optimum and the resulting maximum KS statistic computed using the
returned weights is equal to the one we computed manually. Using
<code>twang</code> also produces the same results.</p>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="unnumbered">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-belitserMeasuringBalanceModel2011" class="csl-entry">
Belitser, Svetlana V., Edwin P. Martens, Wiebe R. Pestman, Rolf H. H.
Groenwold, Anthonius de Boer, and Olaf H. Klungel. 2011.
<span>“Measuring Balance and Model Selection in Propensity Score
Methods.”</span> <em>Pharmacoepidemiology and Drug Safety</em> 20 (11):
1115–29. <a href="https://doi.org/10.1002/pds.2188">https://doi.org/10.1002/pds.2188</a>.
</div>
<div id="ref-diamondGeneticMatchingEstimating2013" class="csl-entry">
Diamond, Alexis, and Jasjeet S. Sekhon. 2013. <span>“Genetic Matching
for Estimating Causal Effects: A General Multivariate Matching Method
for Achieving Balance in Observational Studies.”</span> <em>Review of
Economics and Statistics</em> 95 (3): 932945. <a href="https://doi.org/10.1162/REST_a_00318">https://doi.org/10.1162/REST_a_00318</a>.
</div>
<div id="ref-franklinMetricsCovariateBalance2014" class="csl-entry">
Franklin, Jessica M., Jeremy A. Rassen, Diana Ackermann, Dorothee B.
Bartels, and Sebastian Schneeweiss. 2014. <span>“Metrics for Covariate
Balance in Cohort Studies of Causal Effects.”</span> <em>Statistics in
Medicine</em> 33 (10): 1685–99. <a href="https://doi.org/10.1002/sim.6058">https://doi.org/10.1002/sim.6058</a>.
</div>
<div id="ref-griffinChasingBalanceOther2017" class="csl-entry">
Griffin, Beth Ann, Daniel F. McCaffrey, Daniel Almirall, Lane F.
Burgette, and Claude Messan Setodji. 2017. <span>“Chasing Balance and
Other Recommendations for Improving Nonparametric Propensity Score
Models.”</span> <em>Journal of Causal Inference</em> 5 (2). <a href="https://doi.org/10.1515/jci-2015-0026">https://doi.org/10.1515/jci-2015-0026</a>.
</div>
<div id="ref-hulingIndependenceWeightsCausal2023a" class="csl-entry">
Huling, Jared D., Noah Greifer, and Guanhua Chen. 2023.
<span>“Independence Weights for Causal Inference with Continuous
Treatments.”</span> <em>Journal of the American Statistical
Association</em> 0 (0): 1–14. <a href="https://doi.org/10.1080/01621459.2023.2213485">https://doi.org/10.1080/01621459.2023.2213485</a>.
</div>
<div id="ref-hulingEnergyBalancingCovariate2022" class="csl-entry">
Huling, Jared D., and Simon Mak. 2022. <span>“Energy Balancing of
Covariate Distributions.”</span> <a href="https://doi.org/10.48550/arXiv.2004.13962">https://doi.org/10.48550/arXiv.2004.13962</a>.
</div>
<div id="ref-iacusMultivariateMatchingMethods2011" class="csl-entry">
Iacus, Stefano M., Gary King, and Giuseppe Porro. 2011.
<span>“Multivariate Matching Methods That Are Monotonic Imbalance
Bounding.”</span> <em>Journal of the American Statistical
Association</em> 106 (493): 345–61. <a href="https://doi.org/10.1198/jasa.2011.tm09599">https://doi.org/10.1198/jasa.2011.tm09599</a>.
</div>
<div id="ref-kosmidis2020" class="csl-entry">
Kosmidis, Ioannis, and David Firth. 2020. <span>“Jeffreys-Prior Penalty,
Finiteness and Shrinkage in Binomial-Response Generalized Linear
Models.”</span> <em>Biometrika</em> 108 (1): 71–82. <a href="https://doi.org/10.1093/biomet/asaa052">https://doi.org/10.1093/biomet/asaa052</a>.
</div>
<div id="ref-mccaffreyPropensityScoreEstimation2004" class="csl-entry">
McCaffrey, Daniel F., Greg Ridgeway, and Andrew R. Morral. 2004.
<span>“Propensity Score Estimation With Boosted Regression for
Evaluating Causal Effects in Observational Studies.”</span>
<em>Psychological Methods</em> 9 (4): 403–25. <a href="https://doi.org/10.1037/1082-989X.9.4.403">https://doi.org/10.1037/1082-989X.9.4.403</a>.
</div>
<div id="ref-parastOptimizingVariancebiasTradeoff2017" class="csl-entry">
Parast, Layla, Daniel F. McCaffrey, Lane F. Burgette, Fernando Hoces de
la Guardia, Daniela Golinelli, Jeremy N. V. Miles, and Beth Ann Griffin.
2017. <span>“Optimizing Variance-Bias Trade-Off in the TWANG Package for
Estimation of Propensity Scores.”</span> <em>Health Services and
Outcomes Research Methodology</em> 17 (3): 175–97. <a href="https://doi.org/10.1007/s10742-016-0168-2">https://doi.org/10.1007/s10742-016-0168-2</a>.
</div>
<div id="ref-pirracchioBalanceSuperLearner2018" class="csl-entry">
Pirracchio, Romain, and Marco Carone. 2018. <span>“The Balance Super
Learner: A Robust Adaptation of the <span><em>Super Learner</em></span>
to Improve Estimation of the Average Treatment Effect in the Treated
Based on Propensity Score Matching.”</span> <em>Statistical Methods in
Medical Research</em> 27 (8): 2504–18. <a href="https://doi.org/10.1177/0962280216682055">https://doi.org/10.1177/0962280216682055</a>.
</div>
<div id="ref-stuartPrognosticScorebasedBalance2013" class="csl-entry">
Stuart, Elizabeth A., Brian K. Lee, and Finbarr P. Leacy. 2013.
<span>“Prognostic Score-Based Balance Measures Can Be a Useful
Diagnostic for Propensity Score Methods in Comparative Effectiveness
Research.”</span> <em>Journal of Clinical Epidemiology</em> 66 (8): S84.
<a href="https://doi.org/10.1016/j.jclinepi.2013.01.013">https://doi.org/10.1016/j.jclinepi.2013.01.013</a>.
</div>
<div id="ref-zhuKernelBasedMetricBalance2018" class="csl-entry">
Zhu, Yeying, Jennifer S. Savage, and Debashis Ghosh. 2018. <span>“A
Kernel-Based Metric for Balance Assessment.”</span> <em>Journal of
Causal Inference</em> 6 (2). <a href="https://doi.org/10.1515/jci-2016-0029">https://doi.org/10.1515/jci-2016-0029</a>.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
